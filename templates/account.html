<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>{{ name }} â€” Scanned</title>
  <link rel="stylesheet"
        href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
</head>

<body class="p-4">

  <!-- switch account -->
  <label class="fw-bold">Switch Account:</label>
  <select id="switch" class="form-select d-inline w-auto ms-1"
          onchange="if(this.value) location.href='/account/'+this.value;">
    <option value="">Selectâ€¦</option>
    {% for u in users %}
      <option value="{{ u }}" {% if u==name %}selected{% endif %}>{{ u }}</option>
    {% endfor %}
  </select>

  <!-- carrier selector (persists via URL param) -->
  <label class="fw-bold ms-3">Carrier:</label>
  <select id="carSel" class="form-select d-inline w-auto ms-1"
          onchange="location.href='/account/{{ name }}?carrier='+this.value;">
    {% for c in carriers %}
      <option value="{{ c }}" {% if c==selected_carrier %}selected{% endif %}>{{ c }}</option>
    {% endfor %}
  </select>

  <h2 class="mt-3">ðŸ‘¤ <span class="text-primary">{{ name }} â€” Scanned</span></h2>

  {% if message %}
    <div class="alert alert-warning mt-2">{{ message }}</div>
  {% endif %}

  <!-- scan form -->
  <form method="POST" class="input-group mb-3">
    <input name="picklist" class="form-control" placeholder="Enter / Scan picklist">
    <input type="hidden" name="carrier" value="{{ selected_carrier }}">
    <button class="btn btn-primary">Check</button>
  </form>

  <!-- delete rows -->
  <form method="POST" id="deleteForm">
    <button type="button" class="btn btn-dark btn-sm" onclick="selAll()">Select All</button>
    <button type="button" class="btn btn-danger btn-sm ms-1" id="trigger-delete">Delete Selected</button>
    <input type="hidden" name="delete_items" value="1">

    <table class="table table-bordered mt-2">
      <thead class="table-dark">
        <tr>
          <th style="width:30px"></th>
          <th>Scanned Picklist</th>
          <th>Carrier</th>
          <th>Scanner Name</th>
          <th>Remark</th>
        </tr>
      </thead>
      <tbody>
        {% for r in history %}
        <tr>
          <td><input type="checkbox" name="delete_items" value="{{ r[0] }}"></td>
          <td>{{ r[0] }}</td>
          <td>{{ r[1] }}</td>
          <td>{{ r[2] }}</td>
          <td>{{ r[3] }}</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </form>

  <p class="mt-3">
   
    â†© <a href="{{ url_for('main_page') }}">Back to Main Page</a>
  </p>

  <!-- Delete Confirmation Modal -->
  <div id="confirmModal" style="display:none; position:fixed; inset:0; background:rgba(0,0,0,0.5); z-index:1000; justify-content:center; align-items:center;">
    <div style="background:white; padding:30px 40px; border-radius:10px; box-shadow:0 0 10px rgba(0,0,0,0.3); text-align:center;">
      <p style="font-size:18px; margin-bottom:20px;">Are you sure you want to delete selected items?</p>
      <button id="confirmYes" type="button" style="margin-right:20px; background:#d9534f; color:white; padding:8px 14px; border:none; border-radius:5px;">Yes</button>
      <button id="confirmNo" type="button" style="background:#5bc0de; color:white; padding:8px 14px; border:none; border-radius:5px;">No</button>
    </div>
  </div>

  <script>
    function selAll(){
      document.querySelectorAll('input[name="delete_items"]')
              .forEach(cb => cb.checked = true);
    }

    document.addEventListener("DOMContentLoaded", () => {
      const deleteBtn = document.getElementById("trigger-delete");
      const modal = document.getElementById("confirmModal");
      const yesBtn = document.getElementById("confirmYes");
      const noBtn = document.getElementById("confirmNo");
      const deleteForm = document.getElementById("deleteForm");

      deleteBtn?.addEventListener("click", function() {
        modal.style.display = "flex";
      });

      yesBtn?.addEventListener("click", function() {
        modal.style.display = "none";
        deleteForm?.submit();
      });

      noBtn?.addEventListener("click", function() {
        modal.style.display = "none";
      });
    });
  </script>
</body>
</html>