<!DOCTYPE html>
<html>
<head>
  <title>Scan Picklist</title>
  <link rel="stylesheet"
        href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
  <style>
    body {
      background-image: url("/static/image3.jpg");
      background-size: cover;
      background-position: center;
      background-repeat: no-repeat;
    }
  </style>
</head>
<body class="p-4">
  <h2>ðŸ“¦ <b class="text-success">Scan Picklist</b></h2>

  {% if message %}
    <div class="alert alert-warning mt-2">{{ message }}</div>
  {% endif %}

  <!-- â”€â”€â”€ scan form â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
  <form method="POST">
    <div class="input-group mb-2">
      <input name="picklist" class="form-control" placeholder="Enter / Scan picklist">

      <select name="account" class="form-select">
        {% for u in users %}
          <option value="{{ u }}">{{ u }}</option>
        {% endfor %}
      </select>

      <select name="carrier" class="form-select">
        {% for c in carriers %}
          <option value="{{ c }}" {% if c==current_carrier %}selected{% endif %}>{{ c }}</option>
        {% endfor %}
      </select>

      <button class="btn btn-success">Check</button>
    </div>
  </form>

  <!-- â”€â”€â”€ delete rows â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
  <form method="POST" id="deleteForm">
    <button type="button" class="btn btn-dark btn-sm" onclick="toggleAll()">Select All</button>
    <button type="button" class="btn btn-danger btn-sm" id="trigger-delete">Delete Selected</button>
    <input type="hidden" name="delete_items" value="1">

    <table class="table mt-2 table-bordered">
      <thead class="table-dark">
        <tr>
          <th style="width:25px"></th>
          <th>Scanned Picklist</th>
          <th>Carrier</th>
          <th>Scanner Name(s)</th>
          <th>Remark</th>
        </tr>
      </thead>
      <tbody>
        {% for row in rows %}
        <tr>
          <td><input type="checkbox" name="delete_items" value="{{ row[0] }}"></td>
          <td>{{ row[0] }}</td>
          <td>{{ row[1] }}</td>
          <td>{{ row[2] }}</td>
          <td>{{ row[3] }}</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </form>

  <p class="mt-3">
    â†© <a href="{{ url_for('main_page') }}">Back to Main Page</a>
  </p>

  <!-- Delete Confirmation Modal -->
  <div id="confirmModal" style="display:none; position:fixed; inset:0; background:rgba(0,0,0,0.5); z-index:1000; justify-content:center; align-items:center;">
    <div style="background:white; padding:30px 40px; border-radius:10px; box-shadow:0 0 10px rgba(0,0,0,0.3); text-align:center;">
      <p style="font-size:18px; margin-bottom:20px;">Are you sure you want to delete selected items?</p>
      <button id="confirmYes" type="button" style="margin-right:20px; background:#d9534f; color:white; padding:8px 14px; border:none; border-radius:5px;">Yes</button>
      <button id="confirmNo" type="button" style="background:#5bc0de; color:white; padding:8px 14px; border:none; border-radius:5px;">No</button>
    </div>
  </div>

  <script>
    function toggleAll(){
      document.querySelectorAll('input[type="checkbox"][name="delete_items"]')
              .forEach(cb => cb.checked = true);
    }

    document.addEventListener("DOMContentLoaded", () => {
      const deleteBtn = document.getElementById("trigger-delete");
      const modal = document.getElementById("confirmModal");
      const yesBtn = document.getElementById("confirmYes");
      const noBtn = document.getElementById("confirmNo");
      const deleteForm = document.getElementById("deleteForm");

      deleteBtn?.addEventListener("click", function() {
        modal.style.display = "flex";
      });

      yesBtn?.addEventListener("click", function() {
        modal.style.display = "none";
        deleteForm?.submit();
      });

      noBtn?.addEventListener("click", function() {
        modal.style.display = "none";
      });
    });
  </script>
</body>
</html>